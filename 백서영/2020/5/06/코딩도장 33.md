# 코딩도장 ~33

파이썬 스크립트에서 변수를 만들면 함수 안에서도 사용할 수 있다. 

```python
x = 10
def foo():
	print(x)
	
foo()
print(x)
```

함수의 바깥에서도 x의 값을 출력할 수 있다. 함수를 포함하여 스크립트 전체에서 접근할 수 있는 변수를 전역 변수(global variable)라고 부른다. 전역 변수에 접근할 수 있는 범위를 전역 볌위(global scope)라고 한다.

함수 안에서 만든 변수는 지역 변수(local variable)이다. 지역 변수는 변수를 만든 함수에서만 접근할 수 있고, 함수 바깥에서는 접근할 수 없다. 지역 변수를 접근할 수 있는 범위를 지역 범위(local scope)라고 한다.





### 함수 안에서 전역 변수 변경하기

```python
x = 10
def foo():
	x = 20
	print(X)
	
foo()
print(X)
```

겉으로 보기에는 foo 안의 x는 전역 변수인 것 같지만 실제로는 foo의 지역 변수이다. 즉, 전역 변수 x가 있고, foo에서 지역 변수 x를 새로 만들게 된다. 이 둘을 **이름만 같을 뿐 서로 다른 변수**이다.

**함수 안에서 전역 변수의 값을 변경하려면 global 키워드를 사용해야 한다**. 함수 안에서 global에 전역 변수의 이름을 지정해준다.

- global 전역변수

```python
x = 10
def foo():
	global x # 전역 변수 x를 사용하겠다고 설정
	x = 20 	 # x는 전역 변수
	print(x)
	
foo()
print(x)
```

함수 안에서 변수를 global로 지정하면 전역 변수를 사용하게 된다. 만약 **전역 변수가 없을 때 함수 안에서 global을 사용하게 되면 해당 변수는 전역 변수가 된다**.





#### 네임스페이스

파이썬에서 변수는 네임스페이스(namespace, 이름공간)에 저장된다. locals 함수를 사용하면 현재 네임스페이스를 딕셔너리 형태로 출력할 수 있다. 함수 안에서 locals를 사용할 수도 있다.





### 함수 안에서 함수 만들기

```python
def 함수이름1():
	코드
	def 함수이름2():
		코드
```





### 지역 변수의 범위

```python
def A():
	x = 10
	def B():
		x = 20
	
	B()
	print(x)
	
A()
```

현재 함수의 바깥쪽에 있는 지역 변수의 값을 변경하려면 nonlocal 키워드를 사용해야 한다. 함수 안에서 nonlocal에 지역 변수의 이름을 지정해준다.

```python
def A():
	x = 10
	def B():
		nonlocal x # 현재 함수의 바깥쪽에 있는 지역 변수 사용
		x = 20
	
	B()
	print(x)
	
A()
```

nonlocal은 현재 함수의 지역 변수가 아니라는 뜻이며 바깥쪽 함수의 지역 변수를 사용한다.





### nonlocal이 변수를 찾는 순서

현재 함수의 바깥쪽에 있는 지역 변수를 찾을 때 **가장 가까운 함수먼저 찾는다**.





### global로 전역 변수 사용하기

함수가 몇 단계이든 상관없이 global 키워드를 사용하면 무조건 전역 변수를 사용하게 된다. 전역 변수는 코드가 복잡해졌을 때 변수의 값을 어디서 바꾸는지 알기가 어렵기에 가급적이면 사용하지 않는 것을 권장한다.

```python
x = 1
def A():
	x = 10
	def B():
		x 20
		def C():
			global x
			x = x + 30
			print(x)
		C()
	B()
	
A()
```







### 클로저 사용하기

```python
def calc():
	a = 3
	b = 5
	def mul_add(x):
		return a * x + b
	return mul_add
	
c = calc()
print(c(1), c(2), c(3), c(4), c(5))
```

함수를 둘러싼 환경(지역 변수, 코드 등)을 계속 유지하다가 다시 꺼내서 사용하는 함수를 클로저(closure)라고 한다. 클로저를 사용하면 프로그램의 흐름을 변수에 저장할 수 있으며 지역 변수와 코드를 묶어서 사용하고 싶을 때 활용한다. 클로저에 속한 지역 변수는 바깥에서 직접 접근할 수 없으므로 데이터를 숨기고 싶을 때 활용한다.





### lambda로 클로저 만들기

```python
def calc():
	a = 3
	b = 5
	return lambda x: a * x + b
	
c = calc()
print(c(1), c(2), c(3), c(4), c(5))
```

람다 표현식을 만든 뒤 람다 표현식 자체를 반환했다. 람다는 이름이 없는 익명 함수를 뜻하고, 클로저는 함수를 둘러싼 환경을 유지했다가 나중에 다시 사용하는 함수를 뜻한다.





### 클로저의 지역 변수 변경하기

클로저의 지역 변수를 변경하고 싶다면 nonlocal을 사용하면 된다.