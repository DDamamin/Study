ARP 프로토콜

3계층이라도 같은 네트워크 대역에서 통신하기 위해서는 MAC주소가 필요하다. 따라서 IP주소 만으로 MAC주소를 얻어내는 것이 ARP 프로토콜이다.



구조 (총 28Btye)

2계층 프로토콜 타입: 2Byte (이더넷 0 0 0 1)

ARP에서 사용할 프로토콜 타입: 2Byte (IPv4 0 8 0 0)

Mac Byte 길이: 1Byte (0 6)

IP(프로토콜) 주소 길이: 1Byte (0 4)

Opcode (동작방식): 2Byte (0 0 0 1/2) - 1(물어보는지), 2(응답하는지)

출발지 맥주소 : 6Byte

출발지 IP주소 : 4Byte

목적지 맥주소 : 6Byte

목적지 IP주소 : 4Byte



통신 과정
A와 C 컴퓨터가 있을 때 A가 C의 맥주소를 얻길 원할 때

A는 ARP 프로토콜로 보낸다. 이때 목적지의 맥주소는 0으로 채우고 IP만 채워준다.
또한 이더넷 프로토콜에서는 브로드캐스트로 보낸다.

C를 제외한 컴퓨터들은 ARP 프로토콜을 봤을 때 자신의 IP가 아니므로 버린다.
C는 목적지 맥주소를 채워주고 A에게 보내준다.
(A의 맥주소는 이미 적혀있어 브로드캐스트를 안해도 된다.)

A는 ARP 캐시 테이블에 C의 맥주소를 기록한다.
C 또한 A의 맥주소를 기록한다.



ARP 스푸핑

위에 적혀 있듯 요청 및 응답이 들어오는데로 ARP 테이블에 기록하므로 쉽게 변조 가능하다.(~~비판적 사고가 안된다.~~)

따라서 ARP의 취약점을 이용해 클라이언트에게 서버의 맥주소를 공격자의 맥주소로 서버에게 클라이언트의 맥주소를 공격자의 맥주소로 변경시켜 클라이언트와 서버간 패킷을 빼갈 수 있다. 즉 중간자 공격(MITM)을 할 수 있다.

이를 막는 방법으로는 arp 테이블 중 static이라는 설정으로 mac주소를 컴퓨터가 꺼질 때까지 고정시키는 방법과 mac주소가 변경되면 사람이 직접확인하는 방법 등이 있다.