# Windows API 정복 1권(김상형 저) 정리 11편

**저작권 문제시 연락주시면 바로 처리하도록 하겠습니다. 학생으로서 독서를 읽은 뒤 정리하면서 학습하는 용도로만 사용하였습니다. 양해 부탁드립니다.**

## WM_PAINT 메시지

위 예제는 오로지 문자열 출력 그 자체에만 역점을 두었으며 문자열 출력에 성공하였다.  
하지만 어디까지나 출력 과정을 보이기 위한 예제일 뿐 정상적인 출력을 행하지는 않았으므로 문제점을 가지고 있다.  
어떤 문제인가 하면 출력된 문자열이 그자리에 그대로 있지 않다는 점이다.  
문자열이 출력된 윈도우를 다른 윈도우를 다른 윈도우로 살짝 가렸다가 다시 드러나도록 하거나 윈도우의 크기를 변경하면 출력되어 있던 문자열이 깜쪽같이 사라져 버릴 것이다.  
  
왜냐하면 운영체제가 개별 윈도우의 화면을 보관 및 복구해 주지 않기 때문이다.  
DOS에서는 한 번에 하나의 프로그램만 실행하며 화면을 혼자서 독점하므로 한 번 출력해 놓으면 자신이 일부러 지우지 않는 한 절대로 지워지지 않는다.  
하지만 멀티 태스킹 시스템인 Windows에서는 여러 개의 윈도우가 겹칠 수 있으므로 한 번 출력해 놓은 문자열이 언제까지고 그대로 그 자리에 있다는 보장이 없다.  
다른 윈도우에 의해 가려졌다가 다시 나타나면(이를 Uncover 되었다고 표현한다.) 가려졌던 윈도우의 새로 드러난 부분은 지워져 있게 된다.  
하지만 우리는 Windows 사용중에 이런 현상을 전혀 목격할 수 없었다.  
그 이유는 끊임없이 지워진 부분을 복구하는 방법에 있다.  
  
Windows는 가려졌던 윈도우의 화면을 보관 및 복구하는 책임을 지지 않으며 화면을 복구(Repaint)하는 책임은 전적으로 프로그램 자신에게 있다.  
자신의 작업영역 일부가 지워졌다면 프로그램은 재빠르게 지워진 부분을 복구해야 한다.  
앞에서 만든 예제는 이런 복구를 하지 않았기 때문에 크기가 변하거나 다른 윈도우에 의해 언커버(Uncover)되면 출력해 놓은 문자열이 사라지는 것이다.  
물론 마우스 버튼을 누르면 문자열은 다시 출력되지만 이 문자열도 언젠가는 지워질 것이다.  
  
그렇다면 문제 해결을 위해 예제를 수정하여 화면이 지워지면 다시 복구하도록 만들면 된다.  
마우스 왼쪽 버튼을 누르면 문자열을 출력하는 것이 아니라 화면이 지워질 때마다 문자열을 출력해야 한다.  
그리고 문자열을 출력하는 시점이 바로 WM_PAINT 메시지이다.  
운영체제는 개별 윈도우의 화면을 보관해 주지는 않지만 대신 윈도우의 일부가 지워졌다는 사실을 프로그램으로 즉각 알리며 그 방법은 WM_PAINT 메시지를 보내주는 것이다.  
WM_PAINT 메시지는 "너의 작업영역이 일부 지워졌으니까 빨리 다시 그려라."는 뜻이다.  
  
    LRESULT CALLBACK WndProc(HWND hWnd, UINT iMessage, WPARAM wParam, LPARAM lParam)
    {
	    HDC hdc;
	    PAINTSTRUCT ps;

    	switch (iMessage)
	    {
	    case WM_DESTROY:
		    PostQuitMessage(0);
		    return 0;
	    case WM_PAINT:
		    hdc = BeginPaint(hWnd, &ps);
		    TextOut(hdc, 100, 100, TEXT("Beautiful Korea"), 15);
		    EndPaint(hWnd, &ps);
		    return 0;
	    }

	    return (DefWindowProc(hWnd, iMessage, wParam, lParam));
    }

문자열 출력문이 WM_PAINT 메시지 처리 루틴에 있으므로 여기서 출력한 문자열은 지워져도 항상 다시 복구된다.  
그래서 실제로는 지워졌다가 다시 그려지지만 항상 다시 복구된다.  
그래서 실제로는 지워졌다가 다시 그려지지만 항상 그 자리에 있는 것처럼 보이는 것이다.  
  
Windows에서 화면을 보관, 복구하는 메커니즘이 이런 식이라면 모든 그래픽 출력은 WM_PAINRT 메시지 처리시 해야만 하는가?  
그렇지 않으면 그려놓은 그림이 항상 그 자리에 있는다고 보장할 수 없는가?  
그 대답은 그렇다이다.  
DOS에서와 같이 아무렇게나 화면에 출력해 놓아서는 안 된다.  
그렇다면 모든 프로그램은 현재 화면에 그려진 내용을 철저하게 기억하거나 다시 그리기 위한 준비를 해 놓아야 하는가?  
그 대답도 물론 그렇다이다.  
그 복잡한 출력 형태를 어떻게 다 일일이 기억해 두는가하고 의아해하겠지만 모든 Windows 프로그램이 그렇게 하고 있다.