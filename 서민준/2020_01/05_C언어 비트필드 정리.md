# C언어 비트필드

**출처**  
혼자 연구하는 C/C++ by WinApi 13-4. 비트 구조체  
URL : http://soen.kr/lecture/ccpp/cpp1/13-4-1.htm  
  
C언어 코딩 도장: 56.1 구조체 비트 필드 사용하기  
URL : https://dojang.io/mod/page/view.php?id=472
  
## 정의

멤버가 가질 수 있는 값의 범위가 아주 작다면 작은 단위로 비트를 쪼개서 알뜰하게 정보를 기억시킬 수 있는데 이때 사용하는 것이 바로 비트 구조체(비트 필드)이다. (하지만 난이도가 높고, 접할 기회가 많지 않아 교육 환경에 등장하는 경우는 거의 없다.)  
  
비트 구조체를 선언하는 기본 형식은 다음과 같다.  
  
    struct 구조체 이름
    {
        정수 자료형 멤버 이름 : 비트 수;
    };

각 멤버 이름 다음에 이 멤버의 비트 크기를 적으면 된다. 멤버의 타입은 원칙적으로 정수만 가능하며 부호의 여부에 따라 unsigned 혹은 signed 둘 중 하나의 타입을 지정한다. (당연한 얘기지만 실수형 자료형은 비트 필드에 사용할 수 없다.) 비트로 표현해야 할 정보는 수치값보다는 일종의 기호나 표식인 경우가 많아 부호를 쓰는 경우가 드물어 보편적으로 unsigned를 사용한다.  
  
비트 필드가 선언 순서대로 MSB에 저장될 지, LSB에 저장될지는 컴파일러마다 다른데 일반적으로 오른쪽(LSB)부터 채워나간다.  
  
비트 필드 멤버로 a, b, c가 순서대로 선언되었다고 가정해보자.  
  
    struct Example
    {
        unsigned int a : 1;
        unsigned int b : 2;
        unsigned int c : 3;
    };

이렇게 비트필드가 선언되면, a가 먼저 선언되었으므로 a가 가장 하위 비트에서 시작된다.  
  
비트 필드의 크기는 비트 필드 멤버 중 가장 비트 수가 큰 자료형의 크기가 된다. 위의 경우 세 자료형 모두 unsigned int로 선언되었으므로 sizeof로 구조체의 크기를 측정하면 4가 나옵니다. 만약 unsigned short로 선언하였다면 2가 나옵니다.  
  
## 특징

1. 비트 멤버의 이름을 생략할 수 있다. 이름이 없는 멤버는 코드에서 칭할 수가 없으므로 참조할 수 없고, 메모리 영역만 차지한다.  
  
이게 왜 필요하냐고 생각할 수 있는데, 바이트나 워드의 경계에 걸치면 값을 읽고 쓸 때 쉬프트 연산을 해야 하며 따라서 속도가 떨어지기 때문에 워드의 크기에 맞춰 다음 멤버가 바이트의 처음부터 시작할 수 있도록 하기 위해 조정하는 역할을 할 때 사용된다.  
  
2. 이름이 없는 비트의 크기를 0으로 지정할 수 있다. 이렇게 하면 현재 워드의 미사용 비트를 모두 버린다. 크기가 0인 멤버 다음의 멤버는 새로운 워드의 경계에 배치됨으로써 역시 속도가 향상된다.  
  
3. 비트 멤버는 자신의 타입보다 더 큰 비트 크기를 가질 수 없다.  
  
4. 비트 멤버는 값을 읽을 수도 있고 쓸 수도 있다. 하지만 비트 멤버에 대해서는 예외적으로 & 연산자를 사용할 수 없다. 비트 멤버는 메모리를 점유하고는 있지만 바이트 단위의 주소를 가지는 것은 아니며 구조체 속의 일부로 존재할 뿐이다.  
  
5. 비트 필드와 일반 멤버를 한 구조체에 같이 선언할 수 있다.
